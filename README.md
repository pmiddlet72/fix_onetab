# Fix OneTab - Recovery and Repair Tool

*(Note: this is a hastily created set of scripts given some sword-fighting I've had with it of late. I'm looking to move (or fork, or build) another inactive tab creation tool that is more recently maintained. According to the app info, it hasn't been updated since sometime in 2024 for Chrome and 2023 for FireFox. But knowing it's still widely popular, I figured I'd post this as likely google-chrome browser updates on the Ubuntu 24.04 based distros, I came across a problem where the extension won't load the URLs. So here's a rough solution. I'm happy to expand, update and maintain if the requests arrive. Otherwise feel free to fork and develop it for problems this may in some way apply!)*

This tool helps recover and potentially repair Chrome's OneTab extension when it stops rendering tab links properly. The OneTab extension stores data in Chrome's LevelDB database, and this tool can extract your saved tabs even when the extension UI isn't functioning.

## Problem Description

The OneTab extension occasionally encounters issues where it stops rendering saved links in its interface. This happens while the data is still present in Chrome's local storage. This tool helps users:

1. Discover where OneTab data is stored
2. Extract URLs and titles from the LevelDB database files
3. Export the data to a format that can be imported to Chrome/Firefox bookmarks or other tab managers
4. Attempt to fix the OneTab extension itself

## Prerequisites

- Linux system (tested on Linux Mint/Ubuntu)
- Python 3.6+
- Google Chrome with OneTab extension installed

## Finding and Extracting OneTab Data

### 1. Identify OneTab Storage Location

OneTab data is stored in Chrome's LevelDB database files. The primary location is:

```
~/.config/google-chrome/Default/Local Extension Settings/chphlpgkkbolifaimnlloiipkdnihall/
```

You can confirm this is the correct location by looking for files with `.ldb` and `.log` extensions. These contain your OneTab data.

### 2. Extract Data Using the Script

The `extract_onetab.py` script in this repository scans all the LevelDB files in OneTab's storage location and extracts URLs, titles, and group information.

#### Install and Run

```bash
# Clone or download this repository
cd ~/git/fix_onetab

# Make the script executable
chmod +x extract_onetab.py

# Run the script
./extract_onetab.py
```

By default, the script will:
1. Look for OneTab data in the default Chrome profile location
2. Save extracted URLs to `onetab_urls.json` and `onetab_urls.txt` 
3. Generate a bookmarks HTML file at `onetab_bookmarks.html`

#### Advanced Usage

```bash
# Specify a custom path to OneTab LevelDB files
./extract_onetab.py --path /path/to/custom/location/

# Specify custom output files
./extract_onetab.py --output custom_output.json --html custom_bookmarks.html
```

### 3. What Files Are Created

The script creates three output files:

1. **onetab_urls.json** - A JSON file with all URLs, titles, and group information
2. **onetab_urls.txt** - A plain text file with all URLs and titles, easily readable
3. **onetab_bookmarks.html** - An HTML bookmarks file you can import into Chrome or Firefox

### 4. Verify the Data

Check the extracted data to ensure your URLs were recovered:

```bash
# View the first 20 lines of the text file
head -20 onetab_urls.txt

# Count how many URLs were recovered
wc -l onetab_urls.txt
```

### 5. Import the Recovered Data

#### Import to Chrome

1. Open Chrome and go to Bookmarks menu
2. Select "Import bookmarks and settings"
3. Choose "Bookmarks HTML file"
4. Select the `onetab_bookmarks.html` file generated by the script
5. Your recovered tabs will appear in a folder called "Recovered OneTab URLs"

#### Import to Firefox

1. Open Firefox and press Ctrl+Shift+B to open Bookmarks Manager
2. Click "Import and Backup" and select "Import Bookmarks from HTML"
3. Select the `onetab_bookmarks.html` file
4. Your recovered tabs will appear in the bookmarks menu

## Fixing the OneTab Extension

If you want to try fixing the OneTab extension itself rather than just extracting the data, this project now includes a repair tool.

### Method 1: Using the fix_onetab.py Script

This script attempts to fix OneTab by recreating its state file using the extracted URLs.

```bash
# Run the basic repair (creates a new state file)
./fix_onetab.py

# If that doesn't work, try the --clear-db option (USE WITH CAUTION - this will clear existing data)
# Make sure you have a backup first!
./fix_onetab.py --clear-db
```

The script will:
1. Create a backup of your current OneTab database
2. Create a new state file (`onetab_state.json`) with the recovered URLs
3. Optionally clear problematic database files if the --clear-db flag is used
4. Provide instructions for completing the fix

### Method 2: Using the Manual Import Process

If OneTab appears to be working after running `fix_onetab.py` but you still need to import your tabs:

1. The `fix_onetab.py` script generates a file called `onetab_state.json` in the same directory
2. Open the `onetab_import.html` file in Chrome
3. Due to browser security restrictions, you'll need to:
   - Open the `onetab_state.json` file in a text editor
   - Copy its entire contents
   - Paste into the text area on the `onetab_import.html` page
4. Click "Format for Manual Import" button
5. Copy the formatted JSON
6. Access the OneTab extension's context:
   - Type `chrome://extensions` in the address bar
   - Enable "Developer mode" (toggle in top-right)
   - Find OneTab and click on "background page" under "Inspect views"
7. In the DevTools Console that appears, paste:
   ```javascript
   var state = PASTE_FORMATTED_JSON_HERE;
   localStorage.setItem("state", JSON.stringify(state));
   ```
8. Replace `PASTE_FORMATTED_JSON_HERE` with the copied JSON
9. Press Enter to execute
10. You should see `undefined` in the console - this is normal and indicates the command executed successfully
11. Close and reopen the OneTab extension
12. Your tabs should now appear in OneTab

**Alternative Method**: If you don't see "background page" for the OneTab extension, right-click on the OneTab icon in your browser toolbar and select "Inspect" or "Inspect Popup". Then use the console there to run the code.

**Common Error**: If you try using `chrome.storage.local.set()` in the regular browser console, you'll get "Cannot read properties of undefined (reading 'local')" because extension APIs are only accessible from within the extension's context.

### Fixing Steps in Detail

1. **Backup the current data**
   ```bash
   # The script does this automatically, but you can also do it manually
   mkdir -p backup && cp -r ~/.config/google-chrome/Default/Local\ Extension\ Settings/chphlpgkkbolifaimnlloiipkdnihall/* backup/
   ```

2. **Reset Chrome's extension settings**
   If other methods fail, try:
   ```bash
   # Close Chrome completely
   killall -SIGTERM chrome
   
   # Wait a moment
   sleep 2
   
   # Restart Chrome
   google-chrome
   ```

3. **Reinstall OneTab**
   As a last resort, you may need to:
   - Uninstall the OneTab extension
   - Restart Chrome
   - Reinstall OneTab from the Chrome Web Store
   - Import your bookmarks using the HTML file

## Alternative Tab Managers

If OneTab continues to have issues, you might want to try these alternative tab managers:

- **TabCloud** - Works across Chrome and Firefox
- **Tabs Outliner** - Feature-rich tab manager for Chrome
- **Session Buddy** - Popular Chrome extension for tab management
- **Tab Session Manager** - Good option for Firefox

## How We Discovered the OneTab Data

The process for locating and extracting OneTab data involved:

1. Identifying that OneTab uses Chrome's LevelDB database to store tab information
2. Locating the extension storage at `~/.config/google-chrome/Default/Local Extension Settings/chphlpgkkbolifaimnlloiipkdnihall/`
3. Finding evidence of tab data by examining the LevelDB files with tools like `strings`
4. Creating a Python script to systematically extract structured data from the LevelDB files
5. Converting the extracted data to formats that can be easily imported into browsers

## Technical Details

### OneTab Data Structure

OneTab stores its data in a JSON structure with the following general format:

```json
{
  "tabGroups": [
    {
      "id": "uniqueID",
      "name": "Group Name",
      "tabs": [
        {
          "id": "tabID",
          "url": "https://example.com",
          "title": "Example Website"
        }
      ]
    }
  ]
}
```

This data is stored in LevelDB, a key-value store that Chrome uses for extension data persistence.

### Extraction Method

The script uses a simple approach:
1. It scans all `.ldb` and `.log` files in the OneTab storage directory
2. Uses regex and string matching to identify JSON structures containing tab data
3. Parses the data and reconstructs the tab structure
4. Exports in multiple formats for easy recovery

### Repair Method

The repair script:
1. Creates a backup of current OneTab data
2. Organizes recovered URLs into a proper OneTab state format
3. Generates a clean state file
4. Creates an HTML interface for importing the data
5. Provides options to clear problematic database files if needed

## License

This tool is provided under the MIT License. See the LICENSE file for details. 
