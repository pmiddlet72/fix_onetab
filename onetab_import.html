<!DOCTYPE html>
<html>
<head>
    <title>OneTab - Import Recovered State</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1, h2 {
            color: #2c3e50;
        }
        code {
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .instructions {
            background-color: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #3498db;
            margin-bottom: 20px;
        }
        .warning {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin-bottom: 20px;
        }
        .note {
            background-color: #e9ecef;
            padding: 15px;
            border-left: 4px solid #6c757d;
            margin-bottom: 20px;
        }
        #status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        #formattedJson {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .copy-btn {
            margin-top: 10px;
            background-color: #28a745;
        }
    </style>
</head>
<body>
    <h1>OneTab - Import Recovered State</h1>
    
    <div class="instructions">
        <p>This page helps import your recovered OneTab data directly into Chrome's storage.</p>
        <ol>
            <li>Make sure OneTab extension is installed and enabled</li>
            <li>Paste the content of the <code>onetab_state.json</code> file in the text area below</li>
            <li>Use the "Format for Manual Import" button to prepare the data</li>
            <li>Follow the manual import instructions at the bottom of the page</li>
        </ol>
    </div>
    
    <div class="note">
        <p><strong>Important:</strong> The <code>onetab_state.json</code> file was created by the <code>fix_onetab.py</code> script in the same directory. You'll need to open this file in a text editor and copy its contents to paste here.</p>
    </div>
    
    <div class="warning">
        <p><strong>Note:</strong> Make sure you've backed up your current OneTab data before proceeding.</p>
        <p>If anything goes wrong, you can always import the HTML bookmarks file generated by the extraction script.</p>
    </div>
    
    <h2>OneTab State Data</h2>
    <p>Paste the contents of the <code>onetab_state.json</code> file here:</p>
    <textarea id="stateData" placeholder="Paste the contents of onetab_state.json here..."></textarea>
    
    <button id="importButton">Try Direct Import (Likely Won't Work)</button>
    <button id="formatButton">Format for Manual Import</button>
    
    <div id="status"></div>
    <div id="formattedJson"></div>
    
    <h2>Manual Import Instructions</h2>
    <p>Follow these steps to manually import your OneTab data:</p>
    <ol>
        <li>Click the "Format for Manual Import" button above</li>
        <li>Copy the formatted text that appears</li>
        <li>Open Chrome and type <code>chrome://extensions</code> in the address bar</li>
        <li>Find OneTab in the list and make sure "Developer mode" is enabled (toggle in top-right)</li>
        <li>Click on "background page" under the OneTab extension (in the "Inspect views" section)</li>
        <li>This will open DevTools connected to the OneTab extension</li>
        <li>Go to the "Console" tab in this DevTools window</li>
        <li>Paste the following code:
            <pre><code>var state = PASTE_FORMATTED_JSON_HERE;
localStorage.setItem("state", JSON.stringify(state));</code></pre>
        </li>
        <li>Replace <code>PASTE_FORMATTED_JSON_HERE</code> with the copied formatted JSON</li>
        <li>Press Enter to execute</li>
        <li>You should see <code>undefined</code> returned in the console - this is normal and means the command executed successfully</li>
        <li>Close and reopen the OneTab extension</li>
        <li>Your recovered tabs should now be visible in the OneTab interface</li>
    </ol>
    
    <div class="note">
        <p><strong>Alternative Method:</strong> If you don't see "background page" under the OneTab extension, try this:</p>
        <ol>
            <li>Right-click on the OneTab icon in your browser toolbar</li>
            <li>Select "Inspect" or "Inspect Popup"</li>
            <li>Go to the "Console" tab in DevTools</li>
            <li>Run the code above</li>
        </ol>
    </div>
    
    <script>
        // Try to load state data from the file, but expect CORS errors
        try {
            fetch('onetab_state.json')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('stateData').value = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    console.error('Error loading file:', error);
                    // This is expected due to CORS when loading locally - user will paste the JSON manually
                });
        } catch (e) {
            console.error('Error attempting to fetch state file:', e);
        }
        
        // Import button handler
        document.getElementById('importButton').addEventListener('click', function() {
            const statusDiv = document.getElementById('status');
            statusDiv.className = '';
            statusDiv.textContent = 'Attempting to import...';
            
            try {
                const stateData = JSON.parse(document.getElementById('stateData').value);
                
                // Try to access OneTab's extension ID
                const extensionId = 'chphlpgkkbolifaimnlloiipkdnihall';
                
                // Try using the Chrome messaging API
                if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.sendMessage) {
                    chrome.runtime.sendMessage(extensionId, {
                        action: 'importState',
                        state: stateData
                    }, function(response) {
                        if (chrome.runtime.lastError) {
                            statusDiv.className = 'error';
                            statusDiv.innerHTML = 'Error: ' + chrome.runtime.lastError.message + '<br>' +
                                'This is normal due to browser security restrictions. Please use the manual method below.';
                        } else if (response && response.success) {
                            statusDiv.className = 'success';
                            statusDiv.textContent = 'Import successful! Refresh OneTab to see your tabs.';
                        } else {
                            statusDiv.className = 'error';
                            statusDiv.textContent = 'Import failed. Try the manual steps below.';
                        }
                    });
                } else {
                    // Chrome API not available
                    statusDiv.className = 'error';
                    statusDiv.innerHTML = 'Chrome extension API not available. Please use the manual method below.';
                }
            } catch (e) {
                statusDiv.className = 'error';
                statusDiv.textContent = 'Error parsing JSON: ' + e.message;
            }
        });

        // Format button handler
        document.getElementById('formatButton').addEventListener('click', function() {
            const statusDiv = document.getElementById('status');
            const formattedDiv = document.getElementById('formattedJson');
            
            try {
                const stateData = JSON.parse(document.getElementById('stateData').value);
                
                // Format JSON for console copy-paste
                const formattedJson = JSON.stringify(stateData);
                formattedDiv.textContent = formattedJson;
                formattedDiv.style.display = 'block';
                
                // Add copy button if it doesn't exist
                if (!document.getElementById('copyButton')) {
                    const copyButton = document.createElement('button');
                    copyButton.id = 'copyButton';
                    copyButton.className = 'copy-btn';
                    copyButton.textContent = 'Copy to Clipboard';
                    copyButton.addEventListener('click', function() {
                        navigator.clipboard.writeText(formattedJson).then(function() {
                            copyButton.textContent = 'Copied!';
                            setTimeout(function() {
                                copyButton.textContent = 'Copy to Clipboard';
                            }, 2000);
                        }).catch(function(err) {
                            copyButton.textContent = 'Copy failed. Select text and copy manually.';
                            console.error('Could not copy text: ', err);
                        });
                    });
                    formattedDiv.parentNode.insertBefore(copyButton, formattedDiv.nextSibling);
                }
                
                statusDiv.className = 'success';
                statusDiv.textContent = 'JSON formatted for manual import. Copy it and follow the instructions below.';
            } catch (e) {
                statusDiv.className = 'error';
                statusDiv.textContent = 'Error parsing JSON: ' + e.message;
            }
        });
    </script>
</body>
</html> 